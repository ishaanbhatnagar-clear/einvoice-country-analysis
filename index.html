<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global E-Invoicing Country Analysis</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; line-height: 1.6; color: #1e293b; background: #f8fafc; padding: 20px; -webkit-font-smoothing: antialiased; }
        .container { max-width: 1600px; margin: 0 auto; }
        h1 { color: #0f172a; margin-bottom: 10px; font-size: 2.2em; font-weight: 700; letter-spacing: -0.025em; }
        h2 { color: #1e293b; margin: 30px 0 15px; font-size: 1.5rem; letter-spacing: -0.02em; border-bottom: none; }
        h3 { color: #334155; margin: 20px 0 10px; font-weight: 600; }
        .subtitle { color: #64748b; margin-bottom: 30px; }

        /* Navigation - Segmented Control */
        .main-nav { display: inline-flex; gap: 0; margin-bottom: 25px; background: #f1f5f9; padding: 4px; border-radius: 12px; box-shadow: inset 0 2px 4px rgba(0,0,0,0.02); border: 1px solid #e2e8f0; }
        .nav-btn { padding: 10px 20px; border: none; border-radius: 8px; background: transparent; cursor: pointer; font-size: 0.9em; font-weight: 500; transition: all 0.2s; display: flex; align-items: center; gap: 8px; color: #64748b; }
        .nav-btn:hover:not(.active) { background: rgba(255,255,255,0.5); color: #334155; }
        .nav-btn.active { background: white; color: #0f172a; box-shadow: 0 1px 3px rgba(0,0,0,0.1); font-weight: 600; }
        .nav-btn .icon { font-size: 1.1em; }

        .main-section { display: none; }
        .main-section.active { display: block; }

        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 16px; border: 1px solid rgba(226, 232, 240, 0.8); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03); text-align: center; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .stat-card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025); }
        .stat-number { font-size: 2.5rem; font-weight: 700; background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; letter-spacing: -0.03em; }
        .stat-label { color: #94a3b8; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; }

        /* Tables - Modern Style */
        .table-container { overflow-x: auto; margin-bottom: 30px; border-radius: 16px; border: 1px solid rgba(226, 232, 240, 0.8); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); max-height: 70vh; overflow-y: auto; }
        table { width: 100%; border-collapse: separate; border-spacing: 0; background: white; min-width: 1200px; }
        th { background: rgba(248, 250, 252, 0.95); backdrop-filter: blur(8px); position: sticky; top: 0; z-index: 10; color: #475569; padding: 14px 10px; text-align: left; font-weight: 600; font-size: 0.7rem; cursor: pointer; white-space: nowrap; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid #e2e8f0; }
        th:hover { background: rgba(241, 245, 249, 0.98); }
        th.sortable::after { content: ' \2195'; opacity: 0.5; }
        th.sort-asc::after { content: ' \2191'; opacity: 1; }
        th.sort-desc::after { content: ' \2193'; opacity: 1; }
        td { padding: 14px 10px; border-bottom: 1px solid #f1f5f9; font-size: 0.8em; vertical-align: top; color: #334155; }
        td.wrap { white-space: normal; max-width: 120px; }
        tr:hover { background-color: #f8fafc; }
        tr:last-child td { border-bottom: none; }
        a { color: #3b82f6; text-decoration: none; font-weight: 500; }
        a:hover { text-decoration: underline; color: #2563eb; }

        /* Status & Potential Badges - Soft Pastel Pills */
        .status, .potential, .coverage { padding: 3px 10px; border-radius: 50px; font-size: 0.68em; font-weight: 500; display: inline-block; letter-spacing: 0.01em; }
        .status-active { background: rgba(134, 239, 172, 0.35); color: #15803d; }
        .status-pending { background: rgba(253, 224, 71, 0.35); color: #a16207; }
        .status-planned { background: rgba(196, 181, 253, 0.35); color: #7c3aed; }
        .status-voluntary { background: rgba(203, 213, 225, 0.4); color: #475569; }
        .status-phased { background: rgba(253, 186, 116, 0.35); color: #c2410c; }
        .potential-very-high { background: rgba(252, 165, 165, 0.35); color: #dc2626; }
        .potential-high { background: rgba(253, 186, 116, 0.35); color: #ea580c; }
        .potential-medium { background: rgba(147, 197, 253, 0.35); color: #2563eb; }
        .potential-low { background: rgba(203, 213, 225, 0.4); color: #64748b; }
        .potential-mature { background: rgba(196, 181, 253, 0.35); color: #7c3aed; }
        .coverage-b2b { background: rgba(134, 239, 172, 0.3); color: #16a34a; }
        .coverage-b2g { background: rgba(147, 197, 253, 0.3); color: #2563eb; }
        .coverage-b2c { background: rgba(253, 186, 116, 0.3); color: #ea580c; }
        .accred-yes { color: #dc2626; font-weight: 600; }
        .accred-no { color: #16a34a; }

        /* Toolbar */
        .toolbar { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; background: white; padding: 16px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #e2e8f0; }
        .toolbar-left { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
        .region-filter { padding: 10px 14px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 0.9em; background: #f8fafc; cursor: pointer; color: #334155; font-weight: 500; }
        .region-filter:focus { outline: none; border-color: #3b82f6; background: white; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }

        /* Sort Controls */
        .sort-controls { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
        .sort-btn { padding: 6px 14px; border: 1px solid #e2e8f0; border-radius: 6px; background: #f8fafc; cursor: pointer; font-size: 0.8em; transition: all 0.2s; color: #64748b; font-weight: 500; }
        .sort-btn:hover { border-color: #3b82f6; background: #eff6ff; color: #3b82f6; }
        .sort-btn.active { background: #3b82f6; color: white; border-color: #3b82f6; box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3); }

        /* Search */
        .search-box { width: 100%; max-width: 350px; padding: 10px 14px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 0.9em; background: #f8fafc; }
        .search-box:focus { outline: none; border-color: #3b82f6; background: white; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }

        /* Timeline Graph - Vertical Grouped */
        .timeline-graph { background: white; border-radius: 16px; padding: 25px; border: 1px solid rgba(226, 232, 240, 0.8); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03); margin-bottom: 30px; }
        .timeline-vertical { position: relative; padding-left: 100px; }
        .timeline-year-group { position: relative; margin-bottom: 30px; }
        .timeline-year-label { position: absolute; left: -100px; top: 0; width: 80px; font-size: 1.4em; font-weight: 700; color: #2d3748; text-align: right; }
        .timeline-year-line { position: absolute; left: -10px; top: 0; bottom: -30px; width: 3px; background: linear-gradient(180deg, #4299e1, #9f7aea); border-radius: 3px; }
        .timeline-events { display: flex; flex-wrap: wrap; gap: 10px; padding: 5px 0; }
        .timeline-event { display: flex; align-items: center; gap: 8px; padding: 10px 14px; background: #f7fafc; border-radius: 8px; border-left: 4px solid #e2e8f0; transition: all 0.2s; cursor: default; }
        .timeline-event:hover { background: #edf2f7; transform: translateX(5px); }
        .timeline-event.status-active { border-left-color: #48bb78; background: #f0fff4; }
        .timeline-event.status-pending { border-left-color: #ecc94b; background: #fffff0; }
        .timeline-event.status-planned { border-left-color: #9f7aea; background: #faf5ff; }
        .timeline-event-flag { font-size: 1.3em; }
        .timeline-event-info { display: flex; flex-direction: column; }
        .timeline-event-country { font-weight: 600; color: #2d3748; font-size: 0.95em; }
        .timeline-event-date { font-size: 0.75em; color: #718096; }
        .timeline-event-desc { font-size: 0.75em; color: #4a5568; margin-top: 2px; }
        .timeline-legend { display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
        .timeline-legend-item { display: flex; align-items: center; gap: 6px; font-size: 0.85em; }
        .timeline-legend-dot { width: 12px; height: 12px; border-radius: 3px; }
        .legend-active { background: #48bb78; }
        .legend-pending { background: #ecc94b; }
        .legend-planned { background: #9f7aea; }

        /* Legend Box */
        .legend-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-top: 40px; margin-bottom: 25px; }
        .legend-box { background: white; border-radius: 16px; padding: 18px 20px; border: 1px solid rgba(226, 232, 240, 0.8); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03); }
        .legend-box h4 { color: #1e293b; font-size: 0.9em; margin-bottom: 12px; border-bottom: 1px solid #f1f5f9; padding-bottom: 10px; font-weight: 600; }
        .legend-item { display: flex; align-items: flex-start; margin-bottom: 6px; font-size: 0.78em; }
        .legend-item:last-child { margin-bottom: 0; }
        .legend-item .badge { min-width: 70px; margin-right: 10px; }
        .legend-item .desc { color: #64748b; }

        /* Footer */
        .footer { margin-top: 40px; padding: 20px; text-align: center; color: #718096; font-size: 0.85em; }

        /* Ticker */
        .ticker-wrap { width: 100%; overflow: hidden; background: linear-gradient(90deg, #1e293b, #334155); padding: 10px 0; margin-bottom: 25px; border-radius: 10px; }
        .ticker { display: inline-block; white-space: nowrap; animation: ticker 25s linear infinite; }
        .ticker-item { display: inline-block; padding: 0 50px; color: #fbbf24; font-weight: 500; font-size: 0.85em; }
        .ticker-item span { color: #f8fafc; font-weight: 600; }
        @keyframes ticker { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        /* Players */
        .players { font-size: 0.75em; color: #4a5568; }
        .players strong { color: #2b6cb0; }
        .small-text { font-size: 0.7em; color: #718096; }

        /* Tabs - Pill Style */
        .tabs { display: inline-flex; flex-wrap: wrap; gap: 0; margin-bottom: 20px; background: #f1f5f9; padding: 4px; border-radius: 10px; }
        .tab { padding: 8px 16px; background: transparent; border: none; border-radius: 6px; cursor: pointer; font-size: 0.85em; transition: all 0.2s; color: #64748b; font-weight: 500; }
        .tab:hover:not(.active) { background: rgba(255,255,255,0.5); color: #334155; }
        .tab.active { background: white; color: #0f172a; box-shadow: 0 1px 3px rgba(0,0,0,0.08); font-weight: 600; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        @media (max-width: 768px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            table { font-size: 0.75em; }
            th, td { padding: 6px 4px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Running Ticker Disclaimer -->
        <div class="ticker-wrap">
            <div class="ticker">
                <div class="ticker-item">&#9888;&#65039; <span>DISCLAIMER:</span> This knowledge base is created as of 6 Jan 2025. Data may have changed since then.</div>
                <div class="ticker-item">&#128202; <span>Sources:</span> IMF, VATupdate, KPMG, Basware, Storecove, EDICOM, Fonoa, World Bank</div>
                <div class="ticker-item">&#9888;&#65039; <span>DISCLAIMER:</span> This knowledge base is created as of 6 Jan 2025. Data may have changed since then.</div>
            </div>
        </div>

        <h1>Global E-Invoicing Country Analysis</h1>
        <p class="subtitle">Comprehensive market intelligence for e-invoicing compliance and expansion</p>

        <!-- Main Navigation -->
        <div class="main-nav">
            <button class="nav-btn active" onclick="showMainSection('overview')"><span class="icon">&#128202;</span> Master Table</button>
            <button class="nav-btn" onclick="showMainSection('timeline')"><span class="icon">&#128197;</span> Timeline</button>
            <button class="nav-btn" onclick="showMainSection('legend')"><span class="icon">&#128218;</span> Legend & Methodology</button>
        </div>

        <!-- Section: Overview -->
        <div id="overview" class="main-section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">78</div>
                    <div class="stat-label">Countries Tracked</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">$115T+</div>
                    <div class="stat-label">Total GDP Covered</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">~360M</div>
                    <div class="stat-label">Est. Enterprises</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">~95B+</div>
                    <div class="stat-label">Est. Annual Invoices</div>
                </div>
            </div>

            <div class="toolbar">
                <div class="toolbar-left">
                    <input type="text" class="search-box" id="searchBox" placeholder="Search countries..." onkeyup="filterTable()">
                    <select class="region-filter" id="regionFilter" onchange="filterTable()">
                        <option value="all">All Regions</option>
                        <option value="europe">Europe</option>
                        <option value="apac">Asia-Pacific</option>
                        <option value="mena">Middle East & North Africa</option>
                        <option value="latam">Latin America</option>
                        <option value="africa">Africa</option>
                        <option value="northam">North America</option>
                    </select>
                </div>
                <div class="sort-controls">
                    <span style="font-size:0.8em; color:#64748b; font-weight:500;">Sort by:</span>
                    <button class="sort-btn active" onclick="sortTable('mandate')">Mandate Date</button>
                    <button class="sort-btn" onclick="sortTable('country')">Country</button>
                    <button class="sort-btn" onclick="sortTable('gdp')">GDP</button>
                    <button class="sort-btn" onclick="sortTable('potential')">Potential</button>
                    <button class="sort-btn" onclick="sortTable('tam')">TAM</button>
                    <button class="sort-btn" onclick="sortTable('enterprises')">Enterprises</button>
                </div>
            </div>

            <h2>Master Table</h2>
            <div class="table-container">
            <table id="masterTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th class="sortable">Country</th>
                        <th class="sortable">GDP</th>
                        <th class="sortable">Potential</th>
                        <th class="wrap">Mandate</th>
                        <th>Coverage</th>
                        <th>Model</th>
                        <th>Status</th>
                        <th class="sortable">Enterprises</th>
                        <th class="sortable">Est. Invoices/Yr</th>
                        <th class="sortable">TAM ($M)</th>
                        <th>Tax Authority</th>
                        <th>Accred?</th>
                        <th class="sortable">Accred Time</th>
                        <th>Providers</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
            </div>
        </div>

        <!-- Section: Timeline -->
        <div id="timeline" class="main-section">
            <h2>E-Invoicing Mandate Timeline (2025-2030)</h2>
            <div class="timeline-graph">
                <div class="timeline-legend">
                    <div class="timeline-legend-item"><div class="timeline-legend-dot legend-active"></div> Active / Receiving</div>
                    <div class="timeline-legend-item"><div class="timeline-legend-dot legend-pending"></div> Pending / Phased</div>
                    <div class="timeline-legend-item"><div class="timeline-legend-dot legend-planned"></div> Planned / Future</div>
                </div>
                <div class="timeline-vertical" id="timelineVisual">
                    <!-- Timeline will be generated by JS -->
                </div>
            </div>
            <h3>Detailed Timeline</h3>
            <div class="table-container">
            <table>
                <thead><tr><th>Date</th><th>Country</th><th>Event</th><th>Coverage</th><th>Notes</th></tr></thead>
                <tbody>
                    <tr><td>Jan 2025</td><td>Germany</td><td>RECEIVE mandate</td><td><span class="coverage coverage-b2b">B2B</span></td><td>Must accept e-invoices in EN 16931 format</td></tr>
                    <tr><td>Jan 2025</td><td>Israel</td><td>Clearance begins</td><td><span class="coverage coverage-b2b">B2B</span> <span class="coverage coverage-b2g">B2G</span></td><td>SHAAM system rollout</td></tr>
                    <tr><td>Apr 2025</td><td>Jordan</td><td>Full mandate</td><td><span class="coverage coverage-b2b">B2B</span> <span class="coverage coverage-b2g">B2G</span></td><td>JoFotara system</td></tr>
                    <tr><td>Jul 2025</td><td>Malaysia</td><td>Phase 1</td><td><span class="coverage coverage-b2b">B2B</span> <span class="coverage coverage-b2g">B2G</span></td><td>Large taxpayers (>RM100M)</td></tr>
                    <tr><td>Nov 2025</td><td>Singapore</td><td>InvoiceNow Phase 1</td><td><span class="coverage coverage-b2g">B2G</span></td><td>Government suppliers first</td></tr>
                    <tr><td>Late 2025</td><td>China</td><td>Nationwide expansion</td><td><span class="coverage coverage-b2b">B2B</span> <span class="coverage coverage-b2g">B2G</span> <span class="coverage coverage-b2c">B2C</span></td><td>Fully Digital Fapiao</td></tr>
                    <tr><td>Jan 2026</td><td>Belgium</td><td>Full B2B mandate</td><td><span class="coverage coverage-b2b">B2B</span></td><td>Peppol required</td></tr>
                    <tr><td>Feb 2026</td><td>Poland</td><td>KSeF Phase 1</td><td><span class="coverage coverage-b2b">B2B</span></td><td>Large taxpayers first</td></tr>
                    <tr><td>Jul 2026</td><td>UAE</td><td>Pilot</td><td><span class="coverage coverage-b2b">B2B</span> <span class="coverage coverage-b2g">B2G</span></td><td>Clearance model expected</td></tr>
                    <tr><td>Aug 2026</td><td>Oman</td><td>Top 100 pilot</td><td><span class="coverage coverage-b2b">B2B</span> <span class="coverage coverage-b2g">B2G</span></td><td>Peppol 5-corner; Full Feb 2027</td></tr>
                    <tr><td>Sep 2026</td><td>France</td><td>Large/Mid companies</td><td><span class="coverage coverage-b2b">B2B</span></td><td>PPF + PDP model</td></tr>
                    <tr><td>Jan 2027</td><td>Germany</td><td>SEND mandate (large)</td><td><span class="coverage coverage-b2b">B2B</span></td><td>>&#8364;800k turnover; All Jan 2028</td></tr>
                    <tr><td>2027</td><td>Spain</td><td>Large businesses</td><td><span class="coverage coverage-b2b">B2B</span></td><td>Verifactu system</td></tr>
                    <tr><td>Sep 2027</td><td>France</td><td>SMEs</td><td><span class="coverage coverage-b2b">B2B</span></td><td>All businesses covered</td></tr>
                    <tr><td>Jul 2030</td><td>EU (ViDA)</td><td>Intra-EU B2B</td><td><span class="coverage coverage-b2b">B2B</span></td><td>All EU member states</td></tr>
                </tbody>
            </table>
            </div>
        </div>

        <!-- Section: Legend & Methodology -->
        <div id="legend" class="main-section">
            <h2>Legend & Methodology</h2>
            <div class="legend-container">
                <div class="legend-box">
                    <h4>&#128202; Potential Rating Formula</h4>
                    <div class="legend-item"><span class="desc"><strong>Potential Score</strong> = (GDP Weight x 40%) + (Mandate Stage x 30%) + (Market Maturity x 30%)</span></div>
                    <div class="legend-item"><span class="badge"><span class="potential potential-very-high">Very High</span></span><span class="desc">Score > 80: GDP >$1T + New mandate (high growth)</span></div>
                    <div class="legend-item"><span class="badge"><span class="potential potential-high">High</span></span><span class="desc">Score 60-80: GDP $300B-$1T OR strong mandate momentum</span></div>
                    <div class="legend-item"><span class="badge"><span class="potential potential-medium">Medium</span></span><span class="desc">Score 40-60: GDP $100B-$300B OR niche opportunity</span></div>
                    <div class="legend-item"><span class="badge"><span class="potential potential-mature">Mature</span></span><span class="desc">Mandate 5+ years; Compliance saturated, value-add opportunity</span></div>
                    <div class="legend-item"><span class="badge"><span class="potential potential-low">Low</span></span><span class="desc">Score < 40: GDP <$100B with limited adoption</span></div>
                </div>
                <div class="legend-box">
                    <h4>&#127970; Model Types</h4>
                    <div class="legend-item"><strong style="min-width:70px;">Clearance</strong><span class="desc">Invoice approved by tax authority BEFORE sent to buyer</span></div>
                    <div class="legend-item"><strong style="min-width:70px;">RTIR</strong><span class="desc">Real-Time Invoice Reporting to authority</span></div>
                    <div class="legend-item"><strong style="min-width:70px;">CTC</strong><span class="desc">Continuous Transaction Controls - ongoing reporting</span></div>
                    <div class="legend-item"><strong style="min-width:70px;">Peppol</strong><span class="desc">Open network for B2B/B2G exchange (4-corner)</span></div>
                    <div class="legend-item"><strong style="min-width:70px;">Hybrid</strong><span class="desc">Mix of models (e.g., PPF+PDP in France)</span></div>
                    <div class="legend-item"><strong style="min-width:70px;">ViDA</strong><span class="desc">EU VAT in Digital Age - Jul 2030 mandate</span></div>
                </div>
                <div class="legend-box">
                    <h4>&#127970; Enterprises</h4>
                    <div class="legend-item"><span class="desc"><strong>Definition:</strong> Registered businesses/firms in the country that would be subject to e-invoicing requirements (SMEs + Large enterprises).</span></div>
                    <div class="legend-item"><span class="desc"><strong>Source:</strong> World Bank Enterprise Surveys, national business registries, IMF country data.</span></div>
                    <div class="legend-item"><span class="desc"><strong>Note:</strong> Includes formal sector businesses. Informal sector not counted.</span></div>
                </div>
                <div class="legend-box">
                    <h4>&#128200; Est. Invoices/Year</h4>
                    <div class="legend-item"><span class="desc"><strong>Calculation:</strong> Enterprises x Avg B2B invoices per enterprise (varies by economy size, 50-400/yr).</span></div>
                    <div class="legend-item"><span class="desc"><strong>Factors:</strong> GDP per enterprise, sector mix (manufacturing vs services), B2B transaction density.</span></div>
                    <div class="legend-item"><span class="desc"><strong>Source:</strong> World Bank B2B trade data, national statistics bureaus, industry reports.</span></div>
                </div>
                <div class="legend-box">
                    <h4>&#128176; TAM Calculation</h4>
                    <div class="legend-item"><span class="desc"><strong>Formula:</strong> TAM ($M) = Est. Invoices/Year x $0.15-0.25 per invoice</span></div>
                    <div class="legend-item"><span class="desc"><strong>Pricing basis:</strong> Blended rate covering: compliance/validation ($0.05), transmission ($0.05), archival ($0.03), value-adds ($0.02-0.12).</span></div>
                    <div class="legend-item"><span class="desc"><strong>Note:</strong> Represents total addressable market for e-invoice service providers, not current market size.</span></div>
                </div>
                <div class="legend-box">
                    <h4>&#128205; Coverage Types</h4>
                    <div class="legend-item"><span class="badge"><span class="coverage coverage-b2b">B2B</span></span><span class="desc">Business-to-Business transactions</span></div>
                    <div class="legend-item"><span class="badge"><span class="coverage coverage-b2g">B2G</span></span><span class="desc">Business-to-Government transactions</span></div>
                    <div class="legend-item"><span class="badge"><span class="coverage coverage-b2c">B2C</span></span><span class="desc">Business-to-Consumer transactions</span></div>
                </div>
                <div class="legend-box">
                    <h4>&#128221; Accreditation Notes</h4>
                    <div class="legend-item"><span class="desc"><strong>Accreditation Required:</strong> Whether formal certification/registration with tax authority is needed to operate as an e-invoice provider.</span></div>
                    <div class="legend-item"><span class="desc"><strong>Timeline Calculation:</strong></span></div>
                    <div class="legend-item"><span class="desc">&#8226; <strong>1-2 mo:</strong> Peppol markets (already Peppol AP certified) - just local registration</span></div>
                    <div class="legend-item"><span class="desc">&#8226; <strong>3-6 mo:</strong> Standard clearance markets - technical integration + certification tests</span></div>
                    <div class="legend-item"><span class="desc">&#8226; <strong>6-12 mo:</strong> Complex markets (Brazil, France PDP) - extensive audits, local entity requirements</span></div>
                    <div class="legend-item"><span class="desc">&#8226; <strong>12+ mo:</strong> Restricted markets (China) - local partnerships, government approvals</span></div>
                    <div class="legend-item"><span class="desc"><strong>Assumption:</strong> Clear is already a Peppol-certified Access Point, expediting Peppol-based markets.</span></div>
                </div>
                <div class="legend-box">
                    <h4>&#128200; Market Share %</h4>
                    <div class="legend-item"><span class="desc">Percentages = <strong>estimated share of e-invoice transactions</strong> by provider. Based on industry research, analyst reports, public filings. "(Gov)" = government platform.</span></div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p><strong>Sources:</strong> IMF, VATupdate, KPMG, Basware, Storecove, EDICOM, Fonoa, World Bank, Tax Authority websites</p>
            <p><strong>Knowledge Base Created:</strong> 6 January 2025</p>
        </div>
    </div>

    <script>
        // Country data with all fields
        const countries = [
            { id: 1, country: 'Brazil', flag: '&#127463;&#127479;', region: 'latam', gdp: 2170, gdpStr: '$2,170B', potential: 'Mature', potentialScore: 3, mandate: '2008', coverage: ['B2B','B2G','B2C'], model: 'NF-e (Clearance)', status: 'Active', enterprises: 22000000, invoices: 4500000000, tam: 900, taxAuth: 'RFB', taxUrl: 'https://www.gov.br/receitafederal', accred: 'Yes', accredTime: '6-12 mo', accredMonths: 9, providers: 'Sovos 25%, EDICOM 18%' },
            { id: 2, country: 'Mexico', flag: '&#127474;&#127485;', region: 'latam', gdp: 1470, gdpStr: '$1,470B', potential: 'Mature', potentialScore: 3, mandate: '2010', coverage: ['B2B','B2G','B2C'], model: 'CFDI (Clearance)', status: 'Active', enterprises: 5500000, invoices: 2800000000, tam: 560, taxAuth: 'SAT', taxUrl: 'https://www.sat.gob.mx', accred: 'Yes (PAC)', accredTime: '3-6 mo', accredMonths: 4, providers: 'Edicom 20%, Sovos 15%' },
            { id: 3, country: 'South Korea', flag: '&#127472;&#127479;', region: 'apac', gdp: 1710, gdpStr: '$1,710B', potential: 'Mature', potentialScore: 3, mandate: '2011', coverage: ['B2B','B2G'], model: 'RTIR', status: 'Active', enterprises: 7200000, invoices: 1200000000, tam: 240, taxAuth: 'NTS', taxUrl: 'https://www.nts.go.kr', accred: 'No', accredTime: 'N/A', accredMonths: 0, providers: 'NTS (Gov) 80%' },
            { id: 4, country: 'Turkey', flag: '&#127481;&#127479;', region: 'mena', gdp: 1110, gdpStr: '$1,110B', potential: 'Mature', potentialScore: 3, mandate: '2014', coverage: ['B2B','B2G'], model: 'GIB (Clearance)', status: 'Active', enterprises: 3800000, invoices: 900000000, tam: 180, taxAuth: 'GIB', taxUrl: 'https://www.gib.gov.tr', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'Foriba 30%, Logo 20%' },
            { id: 5, country: 'Italy', flag: '&#127470;&#127481;', region: 'europe', gdp: 2250, gdpStr: '$2,250B', potential: 'High', potentialScore: 4, mandate: '2019', coverage: ['B2B','B2G','B2C'], model: 'SdI (Clearance)', status: 'Active', enterprises: 4500000, invoices: 2400000000, tam: 480, taxAuth: 'AdE', taxUrl: 'https://www.agenziaentrate.gov.it', accred: 'No', accredTime: 'N/A', accredMonths: 0, providers: 'Aruba 25%, TeamSystem 20%' },
            { id: 6, country: 'India', flag: '&#127470;&#127475;', region: 'apac', gdp: 3730, gdpStr: '$3,730B', potential: 'Very High', potentialScore: 5, mandate: '2020', coverage: ['B2B','B2G'], model: 'GST IRP (Clearance)', status: 'Active', enterprises: 63000000, invoices: 8000000000, tam: 1600, taxAuth: 'GSTN', taxUrl: 'https://www.gst.gov.in', accred: 'Yes (IRP/GSP)', accredTime: '2-4 mo', accredMonths: 3, providers: 'ClearTax 35%, Vayana 20%' },
            { id: 7, country: 'Saudi Arabia', flag: '&#127480;&#127462;', region: 'mena', gdp: 1070, gdpStr: '$1,070B', potential: 'Very High', potentialScore: 5, mandate: '2021-2026', coverage: ['B2B','B2G','B2C'], model: 'FATOORA (Clearance)', status: 'Active', enterprises: 1100000, invoices: 450000000, tam: 135, taxAuth: 'ZATCA', taxUrl: 'https://zatca.gov.sa', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'Sovos 22%, EDICOM 18%' },
            { id: 8, country: 'Germany', flag: '&#127465;&#127466;', region: 'europe', gdp: 4520, gdpStr: '$4,520B', potential: 'Very High', potentialScore: 5, mandate: '2025-2028', coverage: ['B2B'], model: 'EN 16931 (Flexible)', status: 'Phased', enterprises: 3700000, invoices: 3200000000, tam: 960, taxAuth: 'BZSt', taxUrl: 'https://www.bzst.de', accred: 'No', accredTime: 'N/A', accredMonths: 0, providers: 'SAP 30%, Pagero 15%' },
            { id: 9, country: 'France', flag: '&#127467;&#127479;', region: 'europe', gdp: 3030, gdpStr: '$3,030B', potential: 'Very High', potentialScore: 5, mandate: 'Sep 2026', coverage: ['B2B'], model: 'PPF+PDP (Hybrid)', status: 'Pending', enterprises: 4200000, invoices: 2800000000, tam: 840, taxAuth: 'DGFiP', taxUrl: 'https://www.impots.gouv.fr', accred: 'Yes (PDP)', accredTime: '6-9 mo', accredMonths: 7, providers: 'Chorus Pro (Gov), Generix 15%' },
            { id: 10, country: 'Spain', flag: '&#127466;&#127480;', region: 'europe', gdp: 1580, gdpStr: '$1,580B', potential: 'Very High', potentialScore: 5, mandate: '2027', coverage: ['B2B'], model: 'Verifactu', status: 'Pending', enterprises: 3400000, invoices: 1800000000, tam: 540, taxAuth: 'AEAT', taxUrl: 'https://www.agenciatributaria.es', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'EDICOM 25%, Seres 18%' },
            { id: 11, country: 'China', flag: '&#127464;&#127475;', region: 'apac', gdp: 17960, gdpStr: '$17,960B', potential: 'Very High', potentialScore: 5, mandate: 'Late 2025', coverage: ['B2B','B2G','B2C'], model: 'Golden Tax (Clearance)', status: 'Active', enterprises: 44000000, invoices: 15000000000, tam: 3000, taxAuth: 'STA', taxUrl: 'http://www.chinatax.gov.cn', accred: 'Yes', accredTime: '12+ mo', accredMonths: 15, providers: 'Baiwang 35%, Aisino 30%' },
            { id: 12, country: 'Japan', flag: '&#127471;&#127477;', region: 'apac', gdp: 4230, gdpStr: '$4,230B', potential: 'Very High', potentialScore: 5, mandate: 'QIS 2023', coverage: ['B2B'], model: 'Peppol', status: 'Voluntary (QIS)', enterprises: 3600000, invoices: 2200000000, tam: 660, taxAuth: 'NTA', taxUrl: 'https://www.nta.go.jp', accred: 'No', accredTime: 'N/A', accredMonths: 0, providers: 'TKC 15%, Freee 12%' },
            { id: 13, country: 'Indonesia', flag: '&#127470;&#127465;', region: 'apac', gdp: 1390, gdpStr: '$1,390B', potential: 'Very High', potentialScore: 5, mandate: '2025-2026', coverage: ['B2B','B2G'], model: 'Coretax (Clearance)', status: 'Active', enterprises: 65000000, invoices: 2500000000, tam: 500, taxAuth: 'DJP', taxUrl: 'https://www.pajak.go.id', accred: 'Yes', accredTime: '6-9 mo', accredMonths: 7, providers: 'DJP (Gov), OnlinePajak 20%' },
            { id: 14, country: 'Malaysia', flag: '&#127474;&#127486;', region: 'apac', gdp: 430, gdpStr: '$430B', potential: 'High', potentialScore: 4, mandate: 'Jul 2025', coverage: ['B2B','B2G'], model: 'MyInvois', status: 'Active', enterprises: 1200000, invoices: 350000000, tam: 105, taxAuth: 'LHDN', taxUrl: 'https://www.hasil.gov.my', accred: 'No', accredTime: 'N/A', accredMonths: 0, providers: 'LHDN (Gov), Storecove 12%' },
            { id: 15, country: 'Singapore', flag: '&#127480;&#127468;', region: 'apac', gdp: 500, gdpStr: '$500B', potential: 'High', potentialScore: 4, mandate: 'Nov 2025', coverage: ['B2G'], model: 'Peppol', status: 'Active', enterprises: 280000, invoices: 180000000, tam: 54, taxAuth: 'IRAS', taxUrl: 'https://www.iras.gov.sg', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'InvoiceNow (Gov), Storecove 15%' },
            { id: 16, country: 'Belgium', flag: '&#127463;&#127466;', region: 'europe', gdp: 630, gdpStr: '$630B', potential: 'High', potentialScore: 4, mandate: 'Jan 2026', coverage: ['B2B'], model: 'Peppol', status: 'Pending', enterprises: 1100000, invoices: 420000000, tam: 126, taxAuth: 'SPF Finances', taxUrl: 'https://finances.belgium.be', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'Basware 15%, Pagero 12%' },
            { id: 17, country: 'Poland', flag: '&#127477;&#127473;', region: 'europe', gdp: 750, gdpStr: '$750B', potential: 'High', potentialScore: 4, mandate: 'Feb 2026', coverage: ['B2B'], model: 'KSeF (Clearance)', status: 'Pending', enterprises: 2300000, invoices: 850000000, tam: 255, taxAuth: 'KAS', taxUrl: 'https://www.podatki.gov.pl', accred: 'No', accredTime: 'N/A', accredMonths: 0, providers: 'KSeF (Gov), Comarch 25%' },
            { id: 18, country: 'UAE', flag: '&#127462;&#127466;', region: 'mena', gdp: 500, gdpStr: '$500B', potential: 'High', potentialScore: 4, mandate: 'Jul 2026', coverage: ['B2B','B2G'], model: 'Clearance', status: 'Pending', enterprises: 450000, invoices: 280000000, tam: 84, taxAuth: 'FTA', taxUrl: 'https://tax.gov.ae', accred: 'TBD', accredTime: 'TBD', accredMonths: 6, providers: 'Sovos 20%, EDICOM 15%' },
            { id: 19, country: 'Australia', flag: '&#127462;&#127482;', region: 'apac', gdp: 1720, gdpStr: '$1,720B', potential: 'High', potentialScore: 4, mandate: 'Voluntary', coverage: ['B2G'], model: 'Peppol', status: 'Voluntary', enterprises: 2500000, invoices: 1100000000, tam: 330, taxAuth: 'ATO', taxUrl: 'https://www.ato.gov.au', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'Link4 18%, MessageXchange 15%' },
            { id: 20, country: 'USA', flag: '&#127482;&#127480;', region: 'northam', gdp: 27360, gdpStr: '$27,360B', potential: 'Very High', potentialScore: 5, mandate: 'Voluntary', coverage: ['B2B'], model: 'DBNAlliance', status: 'Voluntary', enterprises: 33000000, invoices: 25000000000, tam: 5000, taxAuth: 'IRS', taxUrl: 'https://www.irs.gov', accred: 'No', accredTime: 'N/A', accredMonths: 0, providers: 'Coupa, SAP Ariba, Tradeshift' },
            { id: 21, country: 'UK', flag: '&#127468;&#127463;', region: 'europe', gdp: 3340, gdpStr: '$3,340B', potential: 'High', potentialScore: 4, mandate: 'B2G Active', coverage: ['B2G'], model: 'Peppol', status: 'Voluntary', enterprises: 5900000, invoices: 2800000000, tam: 840, taxAuth: 'HMRC', taxUrl: 'https://www.gov.uk/government/organisations/hm-revenue-customs', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'Pagero, Tungsten, Basware' },
            { id: 22, country: 'Oman', flag: '&#127476;&#127474;', region: 'mena', gdp: 115, gdpStr: '$115B', potential: 'Medium', potentialScore: 2, mandate: 'Aug 2026', coverage: ['B2B','B2G'], model: 'Peppol 5-corner', status: 'Pending', enterprises: 85000, invoices: 45000000, tam: 14, taxAuth: 'Tax Authority', taxUrl: 'https://tms.taxoman.gov.om', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'Peppol APs, Storecove 10%' },
            { id: 23, country: 'Vietnam', flag: '&#127483;&#127475;', region: 'apac', gdp: 450, gdpStr: '$450B', potential: 'High', potentialScore: 4, mandate: '2022', coverage: ['B2B','B2G'], model: 'Clearance', status: 'Active', enterprises: 800000, invoices: 320000000, tam: 96, taxAuth: 'GDT', taxUrl: 'https://www.gdt.gov.vn', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'MISA 30%, Viettel 25%' },
            { id: 24, country: 'Romania', flag: '&#127479;&#127476;', region: 'europe', gdp: 350, gdpStr: '$350B', potential: 'High', potentialScore: 4, mandate: 'Jan 2024', coverage: ['B2B','B2G'], model: 'RTIR', status: 'Active', enterprises: 900000, invoices: 280000000, tam: 84, taxAuth: 'ANAF', taxUrl: 'https://www.anaf.ro', accred: 'No', accredTime: 'N/A', accredMonths: 0, providers: 'ANAF (Gov), Postis 18%' },
            { id: 25, country: 'Hungary', flag: '&#127469;&#127482;', region: 'europe', gdp: 210, gdpStr: '$210B', potential: 'Mature', potentialScore: 3, mandate: '2018', coverage: ['B2B','B2G'], model: 'RTIR (NAV)', status: 'Active', enterprises: 750000, invoices: 180000000, tam: 54, taxAuth: 'NAV', taxUrl: 'https://nav.gov.hu', accred: 'No', accredTime: 'N/A', accredMonths: 0, providers: 'NAV (Gov), Ecosio 15%' },
            { id: 26, country: 'Chile', flag: '&#127464;&#127473;', region: 'latam', gdp: 340, gdpStr: '$340B', potential: 'Mature', potentialScore: 3, mandate: '2014', coverage: ['B2B','B2G'], model: 'Clearance', status: 'Active', enterprises: 1200000, invoices: 250000000, tam: 75, taxAuth: 'SII', taxUrl: 'https://www.sii.cl', accred: 'No', accredTime: 'N/A', accredMonths: 0, providers: 'SII (Gov), Sovos 20%' },
            { id: 27, country: 'Philippines', flag: '&#127477;&#127469;', region: 'apac', gdp: 440, gdpStr: '$440B', potential: 'High', potentialScore: 4, mandate: 'Dec 2026', coverage: ['B2B','B2G'], model: 'CTC (EIS)', status: 'Pending', enterprises: 1100000, invoices: 380000000, tam: 114, taxAuth: 'BIR', taxUrl: 'https://www.bir.gov.ph', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'BIR (Gov), Oracle 15%' },
            { id: 28, country: 'Thailand', flag: '&#127481;&#127469;', region: 'apac', gdp: 510, gdpStr: '$510B', potential: 'High', potentialScore: 4, mandate: '2027-2028', coverage: ['B2B','B2G'], model: 'TBD', status: 'Planned', enterprises: 3200000, invoices: 520000000, tam: 156, taxAuth: 'RD', taxUrl: 'https://www.rd.go.th', accred: 'TBD', accredTime: 'TBD', accredMonths: 6, providers: 'TBD' },
            { id: 29, country: 'Netherlands', flag: '&#127475;&#127473;', region: 'europe', gdp: 1090, gdpStr: '$1,090B', potential: 'High', potentialScore: 4, mandate: 'Jul 2030', coverage: ['B2B'], model: 'Peppol (ViDA)', status: 'Planned', enterprises: 2100000, invoices: 850000000, tam: 255, taxAuth: 'Belastingdienst', taxUrl: 'https://www.belastingdienst.nl', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'Basware 18%, Tradeshift 15%' },
            { id: 30, country: 'Sweden', flag: '&#127480;&#127466;', region: 'europe', gdp: 590, gdpStr: '$590B', potential: 'High', potentialScore: 4, mandate: 'Jul 2030', coverage: ['B2B','B2G'], model: 'Peppol (ViDA)', status: 'Planned', enterprises: 1200000, invoices: 480000000, tam: 144, taxAuth: 'Skatteverket', taxUrl: 'https://www.skatteverket.se', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'Pagero 25%, Basware 18%' },
            { id: 31, country: 'Norway', flag: '&#127475;&#127476;', region: 'europe', gdp: 485, gdpStr: '$485B', potential: 'High', potentialScore: 4, mandate: 'Jul 2030', coverage: ['B2B','B2G'], model: 'Peppol (ViDA)', status: 'Planned', enterprises: 600000, invoices: 320000000, tam: 96, taxAuth: 'Skatteetaten', taxUrl: 'https://www.skatteetaten.no', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'Pagero 20%, Visma 18%' },
            { id: 32, country: 'Ireland', flag: '&#127470;&#127466;', region: 'europe', gdp: 530, gdpStr: '$530B', potential: 'High', potentialScore: 4, mandate: 'Nov 2028', coverage: ['B2B'], model: 'Peppol', status: 'Planned', enterprises: 280000, invoices: 180000000, tam: 54, taxAuth: 'Revenue', taxUrl: 'https://www.revenue.ie', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'Tungsten 15%, Basware 12%' },
            { id: 33, country: 'Argentina', flag: '&#127462;&#127479;', region: 'latam', gdp: 640, gdpStr: '$640B', potential: 'High', potentialScore: 4, mandate: '2019', coverage: ['B2B','B2G'], model: 'AFIP (Clearance)', status: 'Active', enterprises: 850000, invoices: 420000000, tam: 126, taxAuth: 'AFIP', taxUrl: 'https://www.afip.gob.ar', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'AFIP (Gov), Sovos 18%' },
            { id: 34, country: 'Colombia', flag: '&#127464;&#127476;', region: 'latam', gdp: 340, gdpStr: '$340B', potential: 'High', potentialScore: 4, mandate: '2018', coverage: ['B2B','B2G'], model: 'Clearance', status: 'Active', enterprises: 1600000, invoices: 380000000, tam: 114, taxAuth: 'DIAN', taxUrl: 'https://www.dian.gov.co', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'DIAN (Gov), Carvajal 20%' },
            { id: 35, country: 'Peru', flag: '&#127477;&#127466;', region: 'latam', gdp: 270, gdpStr: '$270B', potential: 'Medium', potentialScore: 2, mandate: '2014', coverage: ['B2B','B2G'], model: 'Clearance', status: 'Active', enterprises: 2400000, invoices: 280000000, tam: 84, taxAuth: 'SUNAT', taxUrl: 'https://www.sunat.gob.pe', accred: 'Yes (OSE)', accredTime: '3-6 mo', accredMonths: 4, providers: 'SUNAT (Gov), Sovos 15%' },
            { id: 36, country: 'Egypt', flag: '&#127466;&#127468;', region: 'mena', gdp: 400, gdpStr: '$400B', potential: 'High', potentialScore: 4, mandate: '2020-2025', coverage: ['B2B','B2G'], model: 'ETA (Clearance)', status: 'Active', enterprises: 3800000, invoices: 650000000, tam: 195, taxAuth: 'ETA', taxUrl: 'https://www.eta.gov.eg', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'ETA (Gov), Microsoft 12%' },
            { id: 37, country: 'Israel', flag: '&#127470;&#127473;', region: 'mena', gdp: 520, gdpStr: '$520B', potential: 'High', potentialScore: 4, mandate: '2025-2026', coverage: ['B2B','B2G'], model: 'SHAAM (Clearance)', status: 'Active', enterprises: 650000, invoices: 380000000, tam: 114, taxAuth: 'ITA', taxUrl: 'https://taxes.gov.il', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'ITA (Gov), Priority 15%' },
            { id: 38, country: 'Jordan', flag: '&#127471;&#127476;', region: 'mena', gdp: 50, gdpStr: '$50B', potential: 'Low', potentialScore: 1, mandate: 'Apr 2025', coverage: ['B2B','B2G'], model: 'JoFotara (Clearance)', status: 'Active', enterprises: 180000, invoices: 45000000, tam: 14, taxAuth: 'ISTD', taxUrl: 'https://www.istd.gov.jo', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'ISTD (Gov)' },
            { id: 39, country: 'Nigeria', flag: '&#127475;&#127468;', region: 'africa', gdp: 475, gdpStr: '$475B', potential: 'High', potentialScore: 4, mandate: 'Nov 2025', coverage: ['B2B','B2G'], model: 'Clearance', status: 'Pending', enterprises: 42000000, invoices: 850000000, tam: 255, taxAuth: 'FIRS', taxUrl: 'https://www.firs.gov.ng', accred: 'Yes', accredTime: '6-9 mo', accredMonths: 7, providers: 'TBD' },
            { id: 40, country: 'South Africa', flag: '&#127487;&#127462;', region: 'africa', gdp: 400, gdpStr: '$400B', potential: 'High', potentialScore: 4, mandate: 'TBD', coverage: ['B2B','B2G'], model: 'TBD', status: 'Planned', enterprises: 2300000, invoices: 520000000, tam: 156, taxAuth: 'SARS', taxUrl: 'https://www.sars.gov.za', accred: 'TBD', accredTime: 'TBD', accredMonths: 6, providers: 'TBD' },
            { id: 41, country: 'Kenya', flag: '&#127472;&#127466;', region: 'africa', gdp: 110, gdpStr: '$110B', potential: 'Medium', potentialScore: 2, mandate: '2020', coverage: ['B2B','B2G'], model: 'eTIMS', status: 'Active', enterprises: 450000, invoices: 85000000, tam: 26, taxAuth: 'KRA', taxUrl: 'https://www.kra.go.ke', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'KRA (Gov), Tally 15%' },
            // Europe - Additional
            { id: 42, country: 'Austria', flag: '&#127462;&#127481;', region: 'europe', gdp: 470, gdpStr: '$470B', potential: 'High', potentialScore: 4, mandate: 'Jul 2030', coverage: ['B2B','B2G'], model: 'Peppol (ViDA)', status: 'Planned', enterprises: 590000, invoices: 320000000, tam: 96, taxAuth: 'BMF', taxUrl: 'https://www.bmf.gv.at', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'Pagero 18%, Basware 15%' },
            { id: 43, country: 'Switzerland', flag: '&#127464;&#127469;', region: 'europe', gdp: 880, gdpStr: '$880B', potential: 'High', potentialScore: 4, mandate: 'Voluntary', coverage: ['B2B','B2G'], model: 'Peppol', status: 'Voluntary', enterprises: 620000, invoices: 380000000, tam: 114, taxAuth: 'FTA', taxUrl: 'https://www.estv.admin.ch', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'Pagero 20%, Basware 15%' },
            { id: 44, country: 'Finland', flag: '&#127467;&#127470;', region: 'europe', gdp: 300, gdpStr: '$300B', potential: 'High', potentialScore: 4, mandate: 'Jul 2030', coverage: ['B2B','B2G'], model: 'Peppol (ViDA)', status: 'Planned', enterprises: 380000, invoices: 180000000, tam: 54, taxAuth: 'Vero', taxUrl: 'https://www.vero.fi', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'Basware 25%, Pagero 18%' },
            { id: 45, country: 'Denmark', flag: '&#127465;&#127472;', region: 'europe', gdp: 400, gdpStr: '$400B', potential: 'High', potentialScore: 4, mandate: 'Jul 2030', coverage: ['B2B','B2G'], model: 'Peppol (ViDA)', status: 'Planned', enterprises: 350000, invoices: 195000000, tam: 59, taxAuth: 'Skattestyrelsen', taxUrl: 'https://www.skat.dk', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'Pagero 22%, Visma 18%' },
            { id: 46, country: 'Portugal', flag: '&#127477;&#127481;', region: 'europe', gdp: 280, gdpStr: '$280B', potential: 'High', potentialScore: 4, mandate: '2024', coverage: ['B2B','B2G'], model: 'SAF-T', status: 'Active', enterprises: 1400000, invoices: 320000000, tam: 96, taxAuth: 'AT', taxUrl: 'https://www.portaldasfinancas.gov.pt', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'Sage 20%, Primavera 18%' },
            { id: 47, country: 'Greece', flag: '&#127468;&#127479;', region: 'europe', gdp: 220, gdpStr: '$220B', potential: 'High', potentialScore: 4, mandate: '2020', coverage: ['B2B','B2G'], model: 'myDATA', status: 'Active', enterprises: 850000, invoices: 280000000, tam: 84, taxAuth: 'AADE', taxUrl: 'https://www.aade.gr', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'SoftOne 25%, Epsilon Net 20%' },
            { id: 48, country: 'Czech Republic', flag: '&#127464;&#127487;', region: 'europe', gdp: 330, gdpStr: '$330B', potential: 'High', potentialScore: 4, mandate: 'Jul 2030', coverage: ['B2B'], model: 'Peppol (ViDA)', status: 'Planned', enterprises: 1500000, invoices: 380000000, tam: 114, taxAuth: 'MF', taxUrl: 'https://www.mfcr.cz', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'SAP 15%, Helios 20%' },
            { id: 49, country: 'Slovakia', flag: '&#127480;&#127472;', region: 'europe', gdp: 130, gdpStr: '$130B', potential: 'Medium', potentialScore: 2, mandate: 'Jul 2030', coverage: ['B2B'], model: 'Peppol (ViDA)', status: 'Planned', enterprises: 580000, invoices: 145000000, tam: 44, taxAuth: 'FRSR', taxUrl: 'https://www.financnasprava.sk', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'SAP 18%, Pohoda 22%' },
            { id: 50, country: 'Slovenia', flag: '&#127480;&#127470;', region: 'europe', gdp: 65, gdpStr: '$65B', potential: 'Medium', potentialScore: 2, mandate: 'Jul 2030', coverage: ['B2B','B2G'], model: 'Peppol (ViDA)', status: 'Planned', enterprises: 210000, invoices: 65000000, tam: 20, taxAuth: 'FURS', taxUrl: 'https://www.fu.gov.si', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'Birokrat 25%, SAP 15%' },
            { id: 51, country: 'Croatia', flag: '&#127469;&#127479;', region: 'europe', gdp: 80, gdpStr: '$80B', potential: 'Medium', potentialScore: 2, mandate: '2019', coverage: ['B2B','B2G'], model: 'Fiscalization', status: 'Active', enterprises: 180000, invoices: 85000000, tam: 26, taxAuth: 'Porezna', taxUrl: 'https://www.porezna-uprava.hr', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'RBA 20%, Fina 30%' },
            { id: 52, country: 'Bulgaria', flag: '&#127463;&#127468;', region: 'europe', gdp: 95, gdpStr: '$95B', potential: 'Medium', potentialScore: 2, mandate: 'Jul 2030', coverage: ['B2B'], model: 'Peppol (ViDA)', status: 'Planned', enterprises: 420000, invoices: 125000000, tam: 38, taxAuth: 'NRA', taxUrl: 'https://www.nra.bg', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'Microinvest 25%, SAP 12%' },
            { id: 53, country: 'Latvia', flag: '&#127473;&#127483;', region: 'europe', gdp: 45, gdpStr: '$45B', potential: 'Low', potentialScore: 1, mandate: 'Jul 2030', coverage: ['B2B','B2G'], model: 'Peppol (ViDA)', status: 'Planned', enterprises: 180000, invoices: 55000000, tam: 17, taxAuth: 'VID', taxUrl: 'https://www.vid.gov.lv', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'Tildes 30%, SAP 10%' },
            { id: 54, country: 'Lithuania', flag: '&#127473;&#127481;', region: 'europe', gdp: 75, gdpStr: '$75B', potential: 'Medium', potentialScore: 2, mandate: 'Jul 2030', coverage: ['B2B','B2G'], model: 'Peppol (ViDA)', status: 'Planned', enterprises: 250000, invoices: 85000000, tam: 26, taxAuth: 'VMI', taxUrl: 'https://www.vmi.lt', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'Rivil 28%, SAP 12%' },
            { id: 55, country: 'Estonia', flag: '&#127466;&#127466;', region: 'europe', gdp: 40, gdpStr: '$40B', potential: 'Medium', potentialScore: 2, mandate: 'Jul 2030', coverage: ['B2B','B2G'], model: 'Peppol (ViDA)', status: 'Planned', enterprises: 140000, invoices: 48000000, tam: 14, taxAuth: 'EMTA', taxUrl: 'https://www.emta.ee', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'Omniva 30%, RIK 25%' },
            { id: 56, country: 'Luxembourg', flag: '&#127473;&#127482;', region: 'europe', gdp: 85, gdpStr: '$85B', potential: 'Medium', potentialScore: 2, mandate: 'Jul 2030', coverage: ['B2B','B2G'], model: 'Peppol (ViDA)', status: 'Planned', enterprises: 45000, invoices: 35000000, tam: 11, taxAuth: 'ACD', taxUrl: 'https://impotsdirects.public.lu', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'Basware 22%, Pagero 18%' },
            // APAC - Additional
            { id: 57, country: 'Taiwan', flag: '&#127481;&#127484;', region: 'apac', gdp: 790, gdpStr: '$790B', potential: 'High', potentialScore: 4, mandate: '1998', coverage: ['B2B','B2G','B2C'], model: 'eGUI', status: 'Active', enterprises: 1600000, invoices: 850000000, tam: 255, taxAuth: 'MOF', taxUrl: 'https://www.mof.gov.tw', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'Chunghwa 30%, FarEasTone 20%' },
            { id: 58, country: 'Bangladesh', flag: '&#127463;&#127465;', region: 'apac', gdp: 460, gdpStr: '$460B', potential: 'High', potentialScore: 4, mandate: '2024', coverage: ['B2B','B2G'], model: 'NBR', status: 'Active', enterprises: 450000, invoices: 180000000, tam: 54, taxAuth: 'NBR', taxUrl: 'https://www.nbr.gov.bd', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'NBR (Gov), Synesis 15%' },
            { id: 59, country: 'Pakistan', flag: '&#127477;&#127472;', region: 'apac', gdp: 350, gdpStr: '$350B', potential: 'High', potentialScore: 4, mandate: '2024', coverage: ['B2B','B2G'], model: 'FBR', status: 'Active', enterprises: 320000, invoices: 145000000, tam: 44, taxAuth: 'FBR', taxUrl: 'https://www.fbr.gov.pk', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'FBR (Gov), Systems Ltd 18%' },
            { id: 60, country: 'New Zealand', flag: '&#127475;&#127487;', region: 'apac', gdp: 250, gdpStr: '$250B', potential: 'High', potentialScore: 4, mandate: 'Voluntary', coverage: ['B2G'], model: 'Peppol', status: 'Voluntary', enterprises: 550000, invoices: 180000000, tam: 54, taxAuth: 'IRD', taxUrl: 'https://www.ird.govt.nz', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'Xero 35%, MYOB 25%' },
            { id: 61, country: 'Sri Lanka', flag: '&#127473;&#127472;', region: 'apac', gdp: 75, gdpStr: '$75B', potential: 'Medium', potentialScore: 2, mandate: '2024', coverage: ['B2B','B2G'], model: 'IRD', status: 'Active', enterprises: 120000, invoices: 45000000, tam: 14, taxAuth: 'IRD', taxUrl: 'https://www.ird.gov.lk', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'IRD (Gov), hSenid 20%' },
            { id: 62, country: 'Myanmar', flag: '&#127474;&#127474;', region: 'apac', gdp: 60, gdpStr: '$60B', potential: 'Low', potentialScore: 1, mandate: 'TBD', coverage: ['B2B'], model: 'TBD', status: 'Planned', enterprises: 85000, invoices: 25000000, tam: 8, taxAuth: 'IRD', taxUrl: 'https://www.ird.gov.mm', accred: 'TBD', accredTime: 'TBD', accredMonths: 6, providers: 'TBD' },
            { id: 63, country: 'Cambodia', flag: '&#127464;&#127469;', region: 'apac', gdp: 30, gdpStr: '$30B', potential: 'Low', potentialScore: 1, mandate: '2024', coverage: ['B2B','B2G'], model: 'e-Invoice', status: 'Active', enterprises: 55000, invoices: 18000000, tam: 5, taxAuth: 'GDT', taxUrl: 'https://www.tax.gov.kh', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'GDT (Gov)' },
            // MENA - Additional
            { id: 64, country: 'Qatar', flag: '&#127478;&#127462;', region: 'mena', gdp: 220, gdpStr: '$220B', potential: 'High', potentialScore: 4, mandate: 'TBD', coverage: ['B2B','B2G'], model: 'TBD', status: 'Planned', enterprises: 45000, invoices: 35000000, tam: 11, taxAuth: 'GTA', taxUrl: 'https://www.gta.gov.qa', accred: 'TBD', accredTime: 'TBD', accredMonths: 6, providers: 'TBD' },
            { id: 65, country: 'Bahrain', flag: '&#127463;&#127469;', region: 'mena', gdp: 45, gdpStr: '$45B', potential: 'Medium', potentialScore: 2, mandate: 'TBD', coverage: ['B2B','B2G'], model: 'TBD', status: 'Planned', enterprises: 28000, invoices: 18000000, tam: 5, taxAuth: 'NBR', taxUrl: 'https://www.nbr.gov.bh', accred: 'TBD', accredTime: 'TBD', accredMonths: 6, providers: 'TBD' },
            { id: 66, country: 'Kuwait', flag: '&#127472;&#127484;', region: 'mena', gdp: 165, gdpStr: '$165B', potential: 'Medium', potentialScore: 2, mandate: 'TBD', coverage: ['B2B','B2G'], model: 'TBD', status: 'Planned', enterprises: 35000, invoices: 28000000, tam: 8, taxAuth: 'MOF', taxUrl: 'https://www.mof.gov.kw', accred: 'TBD', accredTime: 'TBD', accredMonths: 6, providers: 'TBD' },
            { id: 67, country: 'Morocco', flag: '&#127474;&#127462;', region: 'mena', gdp: 140, gdpStr: '$140B', potential: 'Medium', potentialScore: 2, mandate: '2024', coverage: ['B2B','B2G'], model: 'Clearance', status: 'Active', enterprises: 280000, invoices: 95000000, tam: 29, taxAuth: 'DGI', taxUrl: 'https://www.tax.gov.ma', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'DGI (Gov), Sage 15%' },
            { id: 68, country: 'Tunisia', flag: '&#127481;&#127475;', region: 'mena', gdp: 50, gdpStr: '$50B', potential: 'Low', potentialScore: 1, mandate: '2016', coverage: ['B2B','B2G'], model: 'TTN', status: 'Active', enterprises: 180000, invoices: 45000000, tam: 14, taxAuth: 'DGI', taxUrl: 'https://www.finances.gov.tn', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'TTN (Gov)' },
            { id: 69, country: 'Iraq', flag: '&#127470;&#127478;', region: 'mena', gdp: 270, gdpStr: '$270B', potential: 'Medium', potentialScore: 2, mandate: 'TBD', coverage: ['B2B','B2G'], model: 'TBD', status: 'Planned', enterprises: 95000, invoices: 35000000, tam: 11, taxAuth: 'GCT', taxUrl: 'https://tax.mof.gov.iq', accred: 'TBD', accredTime: 'TBD', accredMonths: 6, providers: 'TBD' },
            // Africa - Additional
            { id: 70, country: 'Ghana', flag: '&#127468;&#127469;', region: 'africa', gdp: 80, gdpStr: '$80B', potential: 'Medium', potentialScore: 2, mandate: 'Oct 2022', coverage: ['B2B','B2G'], model: 'Fiscal Device', status: 'Active', enterprises: 180000, invoices: 65000000, tam: 20, taxAuth: 'GRA', taxUrl: 'https://www.gra.gov.gh', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'GRA (Gov), Hubtel 18%' },
            { id: 71, country: 'Tanzania', flag: '&#127481;&#127487;', region: 'africa', gdp: 75, gdpStr: '$75B', potential: 'Medium', potentialScore: 2, mandate: '2022', coverage: ['B2B','B2G'], model: 'EFD', status: 'Active', enterprises: 165000, invoices: 55000000, tam: 17, taxAuth: 'TRA', taxUrl: 'https://www.tra.go.tz', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'TRA (Gov)' },
            { id: 72, country: 'Uganda', flag: '&#127482;&#127468;', region: 'africa', gdp: 45, gdpStr: '$45B', potential: 'Low', potentialScore: 1, mandate: '2020', coverage: ['B2B','B2G'], model: 'EFRIS', status: 'Active', enterprises: 120000, invoices: 35000000, tam: 11, taxAuth: 'URA', taxUrl: 'https://www.ura.go.ug', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'URA (Gov)' },
            { id: 73, country: 'Rwanda', flag: '&#127479;&#127484;', region: 'africa', gdp: 14, gdpStr: '$14B', potential: 'Low', potentialScore: 1, mandate: '2020', coverage: ['B2B','B2G'], model: 'EBM', status: 'Active', enterprises: 45000, invoices: 15000000, tam: 5, taxAuth: 'RRA', taxUrl: 'https://www.rra.gov.rw', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'RRA (Gov)' },
            { id: 74, country: 'Ethiopia', flag: '&#127466;&#127481;', region: 'africa', gdp: 155, gdpStr: '$155B', potential: 'Medium', potentialScore: 2, mandate: 'TBD', coverage: ['B2B','B2G'], model: 'TBD', status: 'Planned', enterprises: 95000, invoices: 28000000, tam: 8, taxAuth: 'MOR', taxUrl: 'https://www.mor.gov.et', accred: 'TBD', accredTime: 'TBD', accredMonths: 6, providers: 'TBD' },
            // Americas - Additional
            { id: 75, country: 'Ecuador', flag: '&#127466;&#127464;', region: 'latam', gdp: 120, gdpStr: '$120B', potential: 'Medium', potentialScore: 2, mandate: '2012', coverage: ['B2B','B2G'], model: 'Clearance', status: 'Active', enterprises: 520000, invoices: 180000000, tam: 54, taxAuth: 'SRI', taxUrl: 'https://www.sri.gob.ec', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'SRI (Gov), Dtil 20%' },
            { id: 76, country: 'Uruguay', flag: '&#127482;&#127486;', region: 'latam', gdp: 75, gdpStr: '$75B', potential: 'Medium', potentialScore: 2, mandate: '2017', coverage: ['B2B','B2G'], model: 'CFE', status: 'Active', enterprises: 180000, invoices: 85000000, tam: 26, taxAuth: 'DGI', taxUrl: 'https://www.dgi.gub.uy', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'DGI (Gov), Uruware 18%' },
            { id: 77, country: 'Costa Rica', flag: '&#127464;&#127479;', region: 'latam', gdp: 70, gdpStr: '$70B', potential: 'Medium', potentialScore: 2, mandate: '2018', coverage: ['B2B','B2G'], model: 'Clearance', status: 'Active', enterprises: 145000, invoices: 65000000, tam: 20, taxAuth: 'DGT', taxUrl: 'https://www.hacienda.go.cr', accred: 'Yes', accredTime: '3-6 mo', accredMonths: 4, providers: 'Hacienda (Gov), Gosocket 22%' },
            { id: 78, country: 'Canada', flag: '&#127464;&#127462;', region: 'northam', gdp: 2140, gdpStr: '$2,140B', potential: 'Very High', potentialScore: 5, mandate: 'Voluntary', coverage: ['B2G'], model: 'Peppol', status: 'Voluntary', enterprises: 3800000, invoices: 1800000000, tam: 540, taxAuth: 'CRA', taxUrl: 'https://www.canada.ca/en/revenue-agency', accred: 'Yes (Peppol AP)', accredTime: '1-2 mo', accredMonths: 1, providers: 'SAP 20%, Coupa 18%' },
        ];

        let currentSort = { field: 'mandateDate', desc: false };
        let currentRegion = 'all';

        // Provider website URLs mapping
        const providerUrls = {
            'sovos': 'https://sovos.com',
            'edicom': 'https://edicomgroup.com',
            'basware': 'https://www.basware.com',
            'pagero': 'https://www.pagero.com',
            'sap': 'https://www.sap.com',
            'coupa': 'https://www.coupa.com',
            'tradeshift': 'https://tradeshift.com',
            'tungsten': 'https://www.tungsten-network.com',
            'aruba': 'https://www.aruba.it',
            'teamsystem': 'https://www.teamsystem.com',
            'cleartax': 'https://cleartax.in',
            'vayana': 'https://vayana.com',
            'foriba': 'https://www.foriba.com',
            'logo': 'https://www.logo.com.tr',
            'comarch': 'https://www.comarch.com',
            'generix': 'https://www.generixgroup.com',
            'storecove': 'https://www.storecove.com',
            'oracle': 'https://www.oracle.com',
            'microsoft': 'https://www.microsoft.com',
            'sage': 'https://www.sage.com',
            'xero': 'https://www.xero.com',
            'myob': 'https://www.myob.com',
            'tally': 'https://tallysolutions.com',
            'zoho': 'https://www.zoho.com',
            'visma': 'https://www.visma.com',
            'link4': 'https://www.link4.com.au',
            'messagexchange': 'https://www.messagexchange.com',
            'ecosio': 'https://ecosio.com',
            'carvajal': 'https://www.carvajal.com',
            'gosocket': 'https://www.gosocket.net',
            'softone': 'https://www.softone.gr',
            'epsilon net': 'https://www.epsilonnet.gr',
            'primavera': 'https://pt.primaverabss.com',
            'baiwang': 'https://www.baiwang.com',
            'aisino': 'https://www.aisino.com',
            'misa': 'https://www.misa.vn',
            'viettel': 'https://viettel.com.vn',
            'onlinepajak': 'https://www.online-pajak.com',
            'chunghwa': 'https://www.cht.com.tw',
            'fareastone': 'https://www.fetnet.net',
            'priority': 'https://www.priority-software.com',
            'seres': 'https://www.seres.es',
            'hubtel': 'https://hubtel.com',
            'synesis': 'https://synesis-it.com',
            'systems ltd': 'https://www.systemsltd.com',
            'hsenid': 'https://www.hsenidmobile.com',
            'datil': 'https://datil.com',
            'uruware': 'https://uruware.com',
            'freee': 'https://www.freee.co.jp',
            'tkc': 'https://www.tkc.jp',
            'sap ariba': 'https://www.ariba.com',
            'helios': 'https://www.helios.eu',
            'pohoda': 'https://www.stormware.cz',
            'birokrat': 'https://www.birokrat.si',
            'microinvest': 'https://www.microinvest.net',
            'tildes': 'https://www.tilde.lv',
            'rivile': 'https://www.rivile.lt',
            'omniva': 'https://www.omniva.ee',
            'rik': 'https://www.rik.ee',
            'postis': 'https://postis.ro'
        };

        function formatProviders(providersStr) {
            if (!providersStr || providersStr === 'TBD') return providersStr;

            // Split by comma and process each provider
            return providersStr.split(',').map(p => {
                const trimmed = p.trim();
                // Extract provider name (before percentage or parentheses)
                const match = trimmed.match(/^([A-Za-z\s]+)/);
                if (match) {
                    const name = match[1].trim().toLowerCase();
                    const url = providerUrls[name];
                    if (url) {
                        return `<a href="${url}" target="_blank">${trimmed}</a>`;
                    }
                }
                return trimmed;
            }).join(', ');
        }

        // Parse mandate date string to sortable timestamp (closest future date first)
        function parseMandateDate(mandate) {
            if (!mandate) return { date: Infinity, unknown: true };
            const m = mandate.toLowerCase().trim();

            // Known "no timeline" values
            if (m === 'tbd' || m === 'voluntary' || m.includes('voluntary') || m.includes('b2g active')) {
                return { date: Infinity, unknown: true };
            }

            const now = new Date();
            const nowTime = now.getTime();

            // Helper to check if date is past
            const isPast = (date) => date.getTime() < nowTime;

            // Already active/past (just year like 2008, 2010, 2019, etc.)
            const justYear = m.match(/^(\d{4})$/);
            if (justYear) {
                const year = parseInt(justYear[1]);
                const date = new Date(year, 6, 1); // Mid-year
                return { date: date.getTime(), unknown: false, past: isPast(date) };
            }

            // Month Year format (Jan 2026, Sep 2026, Jul 2025)
            const monthYear = m.match(/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\w*\s*(\d{4})$/i);
            if (monthYear) {
                const months = { jan: 0, feb: 1, mar: 2, apr: 3, may: 4, jun: 5, jul: 6, aug: 7, sep: 8, oct: 9, nov: 10, dec: 11 };
                const month = months[monthYear[1].toLowerCase().substring(0, 3)];
                const year = parseInt(monthYear[2]);
                const date = new Date(year, month, 1);
                return { date: date.getTime(), unknown: false, past: isPast(date) };
            }

            // Year range (2021-2026, 2025-2028) - use start year for sorting
            const yearRange = m.match(/(\d{4})\s*[-]\s*(\d{4})/);
            if (yearRange) {
                const startYear = parseInt(yearRange[1]);
                const date = new Date(startYear, 6, 1);
                return { date: date.getTime(), unknown: false, past: isPast(date) };
            }

            // H1/H2 Year format (H1 2027)
            const halfYear = m.match(/(h[12])\s*(\d{4})/i);
            if (halfYear) {
                const month = halfYear[1].toLowerCase() === 'h1' ? 3 : 9;
                const year = parseInt(halfYear[2]);
                const date = new Date(year, month, 1);
                return { date: date.getTime(), unknown: false, past: isPast(date) };
            }

            // Late/Early Year (Late 2025)
            const lateEarly = m.match(/(late|early)\s*(\d{4})/i);
            if (lateEarly) {
                const month = lateEarly[1].toLowerCase() === 'late' ? 10 : 2;
                const year = parseInt(lateEarly[2]);
                const date = new Date(year, month, 1);
                return { date: date.getTime(), unknown: false, past: isPast(date) };
            }

            // QIS or special formats with year (e.g., "QIS 2023", "Oct 2022")
            const anyYear = m.match(/(\d{4})/);
            if (anyYear) {
                const year = parseInt(anyYear[1]);
                const date = new Date(year, 6, 1);
                return { date: date.getTime(), unknown: false, past: isPast(date) };
            }

            return { date: Infinity, unknown: true };
        }

        function getFilteredSortedData() {
            let data = [...countries];

            // Apply region filter
            if (currentRegion !== 'all') {
                data = data.filter(c => c.region === currentRegion);
            }

            // Apply search filter
            const searchFilter = document.getElementById('searchBox').value.toLowerCase();
            if (searchFilter) {
                data = data.filter(c =>
                    c.country.toLowerCase().includes(searchFilter) ||
                    c.model.toLowerCase().includes(searchFilter) ||
                    c.taxAuth.toLowerCase().includes(searchFilter) ||
                    c.mandate.toLowerCase().includes(searchFilter)
                );
            }

            // Apply sort
            if (currentSort.field) {
                if (currentSort.field === 'mandateDate') {
                    data.sort((a, b) => {
                        const aDate = parseMandateDate(a.mandate);
                        const bDate = parseMandateDate(b.mandate);
                        // Active/past mandates at the end, then by date
                        if (aDate.past && !bDate.past) return 1;
                        if (!aDate.past && bDate.past) return -1;
                        if (aDate.unknown && !bDate.unknown) return 1;
                        if (!aDate.unknown && bDate.unknown) return -1;
                        return currentSort.desc ? bDate.date - aDate.date : aDate.date - bDate.date;
                    });
                } else {
                    data.sort((a, b) => {
                        const aVal = a[currentSort.field];
                        const bVal = b[currentSort.field];
                        if (typeof aVal === 'string') {
                            return currentSort.desc ? bVal.localeCompare(aVal) : aVal.localeCompare(bVal);
                        }
                        return currentSort.desc ? bVal - aVal : aVal - bVal;
                    });
                }
            }

            return data;
        }

        function renderTable(data) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = data.map((c, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td><strong>${c.flag} ${c.country}</strong></td>
                    <td>${c.gdpStr}</td>
                    <td><span class="potential potential-${c.potential.toLowerCase().replace(' ','-')}">${c.potential}</span></td>
                    <td class="wrap">${c.mandate}</td>
                    <td>${c.coverage.map(cov => `<span class="coverage coverage-${cov.toLowerCase()}">${cov}</span>`).join(' ')}</td>
                    <td class="small-text">${c.model}</td>
                    <td><span class="status status-${c.status.toLowerCase().split(' ')[0]}">${c.status}</span></td>
                    <td>${(c.enterprises/1000000).toFixed(1)}M</td>
                    <td>${(c.invoices/1000000000).toFixed(1)}B</td>
                    <td>$${c.tam}</td>
                    <td><a href="${c.taxUrl}" target="_blank">${c.taxAuth}</a></td>
                    <td class="${c.accred.includes('Yes') ? 'accred-yes' : 'accred-no'}">${c.accred}</td>
                    <td>${c.accredTime}</td>
                    <td class="players small-text">${formatProviders(c.providers)}</td>
                </tr>
            `).join('');
        }

        function sortTable(field) {
            const fieldMap = {
                'mandate': 'mandateDate',
                'country': 'country',
                'gdp': 'gdp',
                'potential': 'potentialScore',
                'tam': 'tam',
                'enterprises': 'enterprises',
                'accredTime': 'accredMonths'
            };
            const sortField = fieldMap[field] || field;
            const clickedBtn = event.target;

            // If clicking same button that's active, toggle off (show default mandate sort)
            if (clickedBtn.classList.contains('active') && currentSort.field === sortField) {
                currentSort.field = 'mandateDate';
                currentSort.desc = false;
                renderTable(getFilteredSortedData());
                document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector('.sort-btn').classList.add('active'); // First button is Mandate Date
                return;
            }

            if (currentSort.field === sortField) {
                currentSort.desc = !currentSort.desc;
            } else {
                currentSort.field = sortField;
                currentSort.desc = sortField === 'mandateDate' ? false : true; // Mandate sorts ascending by default
            }

            renderTable(getFilteredSortedData());

            // Update button styles
            document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active'));
            clickedBtn.classList.add('active');
        }

        function filterTable() {
            currentRegion = document.getElementById('regionFilter').value;
            renderTable(getFilteredSortedData());
        }

        function showMainSection(id) {
            document.querySelectorAll('.main-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
        }

        function renderTimelineGraph() {
            const container = document.getElementById('timelineVisual');
            const months = { jan: 0, feb: 1, mar: 2, apr: 3, may: 4, jun: 5, jul: 6, aug: 7, sep: 8, oct: 9, nov: 10, dec: 11 };
            const currentYear = new Date().getFullYear();

            // Generate events from all countries
            const knownEvents = [];
            const unknownTimeline = [];

            countries.forEach(c => {
                const parsed = parseMandateDate(c.mandate);
                const mandate = c.mandate.toLowerCase().trim();

                if (parsed.unknown) {
                    unknownTimeline.push(c);
                    return;
                }

                // Determine display date and type
                let year, month, type;
                const statusLower = c.status.toLowerCase();

                if (statusLower === 'active') type = 'active';
                else if (statusLower === 'pending' || statusLower === 'phased') type = 'pending';
                else type = 'planned';

                // Parse specific month/year
                const monthYearMatch = mandate.match(/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\w*\s*(\d{4})$/i);
                if (monthYearMatch) {
                    month = monthYearMatch[1].substring(0, 3).charAt(0).toUpperCase() + monthYearMatch[1].substring(0, 3).slice(1);
                    year = parseInt(monthYearMatch[2]);
                } else {
                    // Extract year from mandate
                    const yearMatch = mandate.match(/(\d{4})/);
                    if (yearMatch) {
                        year = parseInt(yearMatch[1]);
                        // Check for year ranges - use end year
                        const rangeMatch = mandate.match(/(\d{4})\s*[-]\s*(\d{4})/);
                        if (rangeMatch) year = parseInt(rangeMatch[2]);
                        month = '';
                    }
                }

                // H1/H2 format
                const halfMatch = mandate.match(/(h[12])\s*(\d{4})/i);
                if (halfMatch) {
                    month = halfMatch[1].toUpperCase();
                    year = parseInt(halfMatch[2]);
                }

                // Late/Early
                const lateEarlyMatch = mandate.match(/(late|early)\s*(\d{4})/i);
                if (lateEarlyMatch) {
                    month = lateEarlyMatch[1].charAt(0).toUpperCase() + lateEarlyMatch[1].slice(1);
                    year = parseInt(lateEarlyMatch[2]);
                }

                if (year) {
                    knownEvents.push({
                        year,
                        month: month || '',
                        flag: c.flag,
                        country: c.country,
                        type,
                        desc: c.model,
                        sortDate: parsed.date
                    });
                }
            });

            // Sort events by date
            knownEvents.sort((a, b) => a.sortDate - b.sortDate);

            // Group by year
            const grouped = {};
            knownEvents.forEach(evt => {
                if (!grouped[evt.year]) grouped[evt.year] = [];
                grouped[evt.year].push(evt);
            });

            let html = '';

            // Render known timeline years
            Object.keys(grouped).sort((a, b) => parseInt(a) - parseInt(b)).forEach(year => {
                const yearEvents = grouped[year];
                html += `<div class="timeline-year-group">`;
                html += `<div class="timeline-year-label">${year}</div>`;
                html += `<div class="timeline-year-line"></div>`;
                html += `<div class="timeline-events">`;
                yearEvents.forEach(evt => {
                    const statusClass = evt.type === 'active' ? 'status-active' : evt.type === 'pending' ? 'status-pending' : 'status-planned';
                    html += `
                        <div class="timeline-event ${statusClass}">
                            <span class="timeline-event-flag">${evt.flag}</span>
                            <div class="timeline-event-info">
                                <span class="timeline-event-country">${evt.country}</span>
                                <span class="timeline-event-date">${evt.month ? evt.month + ' ' : ''}${evt.year}</span>
                                <span class="timeline-event-desc">${evt.desc}</span>
                            </div>
                        </div>
                    `;
                });
                html += `</div></div>`;
            });

            // Render unknown timeline section
            if (unknownTimeline.length > 0) {
                html += `<div class="timeline-year-group timeline-unknown">`;
                html += `<div class="timeline-year-label">TBD</div>`;
                html += `<div class="timeline-year-line" style="background: #94a3b8;"></div>`;
                html += `<div class="timeline-events">`;
                unknownTimeline.sort((a, b) => b.gdp - a.gdp).forEach(c => {
                    html += `
                        <div class="timeline-event status-voluntary">
                            <span class="timeline-event-flag">${c.flag}</span>
                            <div class="timeline-event-info">
                                <span class="timeline-event-country">${c.country}</span>
                                <span class="timeline-event-date">${c.mandate}</span>
                                <span class="timeline-event-desc">${c.model || 'Timeline not announced'}</span>
                            </div>
                        </div>
                    `;
                });
                html += `</div></div>`;
            }

            container.innerHTML = html;
        }

        // Initialize with default sort by mandate date
        renderTable(getFilteredSortedData());
        renderTimelineGraph();
    </script>
</body>
</html>
